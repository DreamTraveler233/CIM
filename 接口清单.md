# 接口清单

> 基于现有前端 `src/apis/api.ts` 与自动生成的 `types.d.ts` 梳理。建议在 C++ 后端实现时保持以下契约一致，便于前端直接复用。

## 1. 通用约定
- **基础地址**：`${VITE_BASE_API}`，所有接口前缀 `/api/v1/`
- **数据格式**：`Content-Type: application/json; charset=utf-8`
- **鉴权方式**：登录后返回 Bearer Token，前端通过 `Authorization: Bearer <token>` 发送。
- **统一返回结构（建议）**：
  ```json
  {
    "code": 200,
    "message": "OK",
    "data": { /* 业务数据 */ }
  }
  ```
  - `code`：0/200 表示成功，非 0/200 表示失败。
  - `message`：简要说明。
  - `data`：接口主体。
- **错误处理**：前端期望 401 时触发重新登录；网络/超时将提示“网络连接失败，请重试”。建议用明确的业务错误码覆盖常见异常。

## 2. 认证与账户

| 功能 | 方法 | 路径 | 描述 | 请求体 | 响应体 |
| --- | --- | --- | --- | --- | --- |
| 登录 | POST | `/api/v1/auth/login` | 用户名/手机号/邮箱+密码登录 | `AuthLoginRequest` | `AuthLoginResponse` |
| 注册 | POST | `/api/v1/auth/register` | 新用户注册 | `AuthRegisterRequest` | `AuthRegisterResponse` |
| 忘记密码 | POST | `/api/v1/auth/forget` | 通过邮箱/短信重置 | `AuthForgetRequest` | `AuthForgetResponse` |
| 获取 OAuth 地址 | POST | `/api/v1/auth/oauth` | 获取第三方授权链接 | `AuthOauthRequest` | `AuthOauthResponse` |
| 第三方登录 | POST | `/api/v1/auth/oauth/login` | 使用第三方 code 登录 | `AuthOauthLoginRequest` | `AuthOauthLoginResponse` |
| 绑定第三方 | POST | `/api/v1/auth/oauth/bind` | 将三方账号绑定到当前用户 | `AuthOAuthBindRequest` | `AuthOAuthBindResponse` |

### 用户资料
| 功能 | 方法 | 路径 | 描述 | 请求体 | 响应体 |
| --- | --- | --- | --- | --- | --- |
| 获取用户详情 | POST | `/api/v1/user/detail` | 当前登录用户信息 | `UserDetailRequest` | `UserDetailResponse` |
| 更新用户信息 | POST | `/api/v1/user/detail-update` | 修改昵称、头像等 | `UserDetailUpdateRequest` | `UserDetailUpdateResponse` |
| 更新邮箱 | POST | `/api/v1/user/email-update` | 更换绑定邮箱 | `UserEmailUpdateRequest` | `UserEmailUpdateResponse` |
| 更新手机号 | POST | `/api/v1/user/mobile-update` | 更换绑定手机号 | `UserMobileUpdateRequest` | `UserMobileUpdateResponse` |
| 更新密码 | POST | `/api/v1/user/password-update` | 修改密码 | `UserPasswordUpdateRequest` | `UserPasswordUpdateResponse` |
| 获取配置信息 | POST | `/api/v1/user/setting` | 主题、音效等偏好 | `UserSettingRequest` | `UserSettingResponse` |

## 3. 通用能力

| 功能 | 方法 | 路径 | 描述 |
| --- | --- | --- | --- |
| 发送短信验证码 | POST | `/api/v1/common/send-sms` | 请求体 `CommonSendSmsRequest`，响应 `CommonSendSmsResponse` |
| 发送邮件验证码 | POST | `/api/v1/common/send-email` | `CommonSendEmailRequest` → `CommonSendEmailResponse` |
| 测试发送（示例接口） | POST | `/api/v1/common/send-test` | `CommonSendTestRequest` → `CommonSendTestResponse` |

## 4. 联系人 & 好友

| 功能 | 方法 | 路径 | 描述 |
| --- | --- | --- | --- |
| 申请好友 | POST | `/api/v1/contact-apply/create` | `ContactApplyCreateRequest` → `ContactApplyCreateResponse` |
| 同意申请 | POST | `/api/v1/contact-apply/accept` | `ContactApplyAcceptRequest` → `ContactApplyAcceptResponse` |
| 拒绝申请 | POST | `/api/v1/contact-apply/decline` | `ContactApplyDeclineRequest` → `ContactApplyDeclineResponse` |
| 删除申请 | POST | `/api/v1/contact-apply/delete` | `ContactApplyDeleteRequest` → `ContactApplyDeleteResponse` |
| 申请列表 | POST | `/api/v1/contact-apply/list` | `ContactApplyListRequest` → `ContactApplyListResponse` |
| 申请未读数 | POST | `/api/v1/contact-apply/unread-num` | `ContactApplyUnreadNumRequest` → `ContactApplyUnreadNumResponse` |
| 联系人列表 | POST | `/api/v1/contact/list` | `ContactListRequest` → `ContactListResponse` |
| 搜索联系人 | POST | `/api/v1/contact/search` | `ContactSearchRequest` → `ContactSearchResponse` |
| 联系人详情 | POST | `/api/v1/contact/detail` | `ContactDetailRequest` → `ContactDetailResponse` |
| 删除联系人 | POST | `/api/v1/contact/delete` | `ContactDeleteRequest` → `ContactDeleteResponse` |
| 修改备注 | POST | `/api/v1/contact/edit-remark` | `ContactEditRemarkRequest` → `ContactEditRemarkResponse` |
| 调整分组 | POST | `/api/v1/contact/change-group` | `ContactChangeGroupRequest` → `ContactChangeGroupResponse` |
| 分组列表 | POST | `/api/v1/contact-group/list` | `ContactGroupListRequest` → `ContactGroupListResponse` |
| 保存分组 | POST | `/api/v1/contact-group/save` | `ContactGroupSaveRequest` → `ContactGroupSaveResponse` |
| 获取在线状态 | POST | `/api/v1/contact/online-status` | `ContactOnlineStatusRequest` → `ContactOnlineStatusResponse` |

### 企业通讯录
| 功能 | 方法 | 路径 | 描述 |
| --- | --- | --- | --- |
| 部门列表 | POST | `/api/v1/organize/department-list` | `OrganizeDepartmentListRequest` → `OrganizeDepartmentListResponse` |
| 人员列表 | POST | `/api/v1/organize/personnel-list` | `OrganizePersonnelListRequest` → `OrganizePersonnelListResponse` |

## 5. 群组相关

| 功能 | 方法 | 路径 |
| --- | --- | --- |
| 创建群 | POST | `/api/v1/group/create` |
| 群详情 | POST | `/api/v1/group/detail` |
| 解散群 | POST | `/api/v1/group/dismiss` |
| 更换群主 | POST | `/api/v1/group/handover` |
| 群设置 | POST | `/api/v1/group/setting` |
| 修改群公告 | POST | `/api/v1/group-notice/edit` |
| 群列表 | POST | `/api/v1/group/list` |
| 群成员列表 | POST | `/api/v1/group/member-list` |
| 邀请进群 | POST | `/api/v1/group/invite` |
| 可邀请好友 | POST | `/api/v1/group/get-invite-friends` |
| 移交管理员 | POST | `/api/v1/group/assign-admin` |
| 移除成员 | POST | `/api/v1/group/remove-member` |
| 退出群聊 | POST | `/api/v1/group/secede` |
| 群禁言 | POST | `/api/v1/group/mute` |
| 群成员禁言 | POST | `/api/v1/group/no-speak` |
| 群对外公开配置 | POST | `/api/v1/group/overt` |
| 公开群列表 | POST | `/api/v1/group/overt-list` |
| 更新群名片 | POST | `/api/v1/group/remark-update` |

### 群申请/邀约
| 功能 | 方法 | 路径 |
| --- | --- | --- |
| 创建入群申请 | POST | `/api/v1/group-apply/create` |
| 同意申请 | POST | `/api/v1/group-apply/agree` |
| 拒绝申请 | POST | `/api/v1/group-apply/decline` |
| 删除申请 | POST | `/api/v1/group-apply/delete` |
| 申请列表 | POST | `/api/v1/group-apply/list` |
| 所有申请（管理员视图） | POST | `/api/v1/group-apply/all` |
| 未读申请数 | POST | `/api/v1/group-apply/unread-num` |

### 群投票
| 功能 | 方法 | 路径 |
| --- | --- | --- |
| 创建投票 | POST | `/api/v1/group-vote/create` |
| 投票详情 | POST | `/api/v1/group-vote/detail` |
| 提交投票 | POST | `/api/v1/group-vote/submit` |

> 上述接口请求/响应体分别对应 `Group*Request`、`Group*Response` 系列。

## 6. 会话与消息

| 功能 | 方法 | 路径 |
| --- | --- | --- |
| 创建会话 | POST | `/api/v1/talk/session-create` |
| 删除会话 | POST | `/api/v1/talk/session-delete` |
| 会话列表 | POST | `/api/v1/talk/session-list` |
| 会话置顶 | POST | `/api/v1/talk/session-top` |
| 会话免打扰 | POST | `/api/v1/talk/session-disturb` |
| 清除未读数 | POST | `/api/v1/talk/session-clear-unread-num` |

### 消息
| 功能 | 方法 | 路径 |
| --- | --- | --- |
| 获取消息记录 | POST | `/api/v1/message/records` |
| 获取历史记录 | POST | `/api/v1/message/history-records` |
| 转发记录 | POST | `/api/v1/message/forward-records` |
| 删除消息 | POST | `/api/v1/message/delete` |
| 撤回消息 | POST | `/api/v1/message/revoke` |

> 请求/响应体：`Message*Request` → `Message*Response`。

## 7. 表情/素材

| 功能 | 方法 | 路径 |
| --- | --- | --- |
| 新建自定义表情 | POST | `/api/v1/emoticon/customize/create` |
| 删除自定义表情 | POST | `/api/v1/emoticon/customize/delete` |
| 表情列表 | POST | `/api/v1/emoticon/customize/list` |

## 8. 笔记/文章模块

对应富文本笔记（`views/note`）：

| 功能 | 方法 | 路径 |
| --- | --- | --- |
| 文章列表 | POST | `/api/v1/article/list` |
| 文章详情 | POST | `/api/v1/article/detail` |
| 新增/编辑文章 | POST | `/api/v1/article/editor` |
| 删除文章 | POST | `/api/v1/article/delete` |
| 永久删除文章 | POST | `/api/v1/article/forever-delete` |
| 恢复文章 | POST | `/api/v1/article/recover` |
| 回收站列表 | POST | `/api/v1/article/recover-list` |
| 移动文章 | POST | `/api/v1/article/move` |
| 设置标签 | POST | `/api/v1/article/tags` |
| 收藏/取消收藏 | POST | `/api/v1/article/asterisk` |

### 分类管理
| 功能 | 方法 | 路径 |
| --- | --- | --- |
| 分类列表 | POST | `/api/v1/article/classify/list` |
| 新增/编辑分类 | POST | `/api/v1/article/classify/edit` |
| 删除分类 | POST | `/api/v1/article/classify/delete` |
| 排序分类 | POST | `/api/v1/article/classify/sort` |

### 附件管理
| 功能 | 方法 | 路径 |
| --- | --- | --- |
| 附件删除 | POST | `/api/v1/article-annex/delete` |
| 永久删除附件 | POST | `/api/v1/article-annex/forever-delete` |
| 恢复附件 | POST | `/api/v1/article-annex/recover` |
| 附件回收站列表 | POST | `/api/v1/article-annex/recover-list` |

## 9. WebSocket 协议（概要）
- 连接地址：`${VITE_SOCKET_API}/wss/default.io?token=<Bearer Token>`
- 心跳：前端定时发送 `{"event":"ping"}`，期待 `pong`。
- 业务事件（`event` 字段）：
  - `im.message`：聊天消息，携带消息体。
  - `im.message.keyboard`：输入状态提醒。
  - `im.message.revoke`：撤回通知。
  - `im.contact.apply`：好友申请提醒。
  - `im.group.apply`：群申请提醒。
  - `event_error`：错误事件，包含 `error_code`、`error_message`。
- 消息 ACK：若 payload 含 `ackid`，前端会回传 `{"event":"ack","ackid":"..."}`，后端需保证幂等。
- 重连策略：前端默认指数退避 5 次，最大 100 次尝试；需在后端支持断线重连。

## 10. 实施建议
1. **类型对齐**：生成服务端 DTO 时可直接参考 `src/apis/types.d.ts`，避免命名差异。
2. **鉴权中间件**：统一校验 Bearer Token，向下游传递用户 ID、角色等。
3. **日志与审计**：消息、群管理、登录等接口建议记录操作日志，便于审计与问题定位。
4. **限流与防刷**：短信、邮件、好友/群申请接口应有频率限制，并与前端的节流提示保持一致。
5. **版本化**：当前接口集中在 `/api/v1/`，未来变更可通过 `/api/v2/` 同时支持灰度。

---
如需补充具体字段说明，可依据自动生成的 `src/apis/types.d.ts` 或原始 OpenAPI 文档进一步细化。